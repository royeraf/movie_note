[build]
  # Build the frontend and then prepare the functions directory
  # We copy the 'api' package into the function folder so it can be imported
  command = "bun run build && mkdir -p netlify/functions/app && cp -r api netlify/functions/app/ && cp api/requirements.txt netlify/functions/app/requirements.txt"
  publish = "dist"

[functions]
  directory = "netlify/functions"

[[redirects]]
  # Redirect all API calls to the serverless function 'app' (main.py)
  from = "/api/*"
  to = "/.netlify/functions/app"
  status = 200

[[redirects]]
  # SPA routing: redirect all other requests to index.html
  from = "/*"
  to = "/index.html"
  status = 200
